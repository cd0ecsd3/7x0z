<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Gravity Singularity - Enhanced Audio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden; background-color: #000;
            cursor: none; font-family: 'Courier New', monospace;
        }
        canvas { position: absolute; top: 0; left: 0; }
        .ui-panel {
            position: fixed; inset: 0;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            background: #000; z-index: 100;
            transition: opacity 1s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #hud {
            position: fixed; top: 20px; left: 20px;
            color: #ff3300; font-size: 10px;
            pointer-events: none; opacity: 0.8;
            z-index: 10; line-height: 1.5;
        }
        .crosshair {
            position: fixed; width: 30px; height: 30px;
            border: 1px solid rgba(255, 50, 0, 0.8);
            border-radius: 50%; pointer-events: none;
            transform: translate(-50%, -50%); z-index: 100;
            box-shadow: 0 0 15px rgba(255, 50, 0, 0.2);
        }
    </style>
</head>
<body>

    <div id="hud">
        SINGULARITAS: AKTIF<br>
        MASSA: <span id="mass-val">1.0</span><br>
        PARTIKEL: 2500<br>
        STATUS: <span id="status-val">STABIL</span>
    </div>

    <div id="cursor" class="crosshair"></div>
    <canvas id="canvas"></canvas>

    <div id="overlay" class="ui-panel">
        <div class="text-center p-10 border border-red-900/30 bg-black">
            <h1 class="text-white text-5xl font-black mb-2 tracking-tighter">EVENT_HORIZON</h1>
            <p class="text-red-600 mb-10 text-xs tracking-[0.4em] animate-pulse">PERINGATAN: DISTORSI AUDIO & GRAVITASI TINGGI</p>
            <button id="ignite-btn" class="px-12 py-4 bg-red-950 text-red-500 border border-red-500 hover:bg-red-500 hover:text-black transition-all font-bold uppercase tracking-widest text-xs">
                AKTIFKAN SINGULARITAS
            </button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const overlay = document.getElementById('overlay');
        const cursor = document.getElementById('cursor');

        let audioCtx, masterGain, droneOsc, droneGain;
        let isRunning = false;
        let particles = [];
        const particleCount = 2500;
        let mouse = { x: -100, y: -100 };
        let currentIntensity = 0;

        class Particle {
            constructor() {
                this.reset();
            }
            reset() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.color = Math.random() > 0.8 ? '#ff3300' : '#ffffff';
                this.size = Math.random() * 2;
            }
            update() {
                const dx = mouse.x - this.x;
                const dy = mouse.y - this.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                
                // Kekuatan hisap lebih kuat
                const force = Math.min(3, 800 / (dist * dist + 150));

                if (dist < 8) this.reset();

                this.vx += (dx / dist) * force;
                this.vy += (dy / dist) * force;

                this.vx *= 0.97;
                this.vy *= 0.97;

                this.x += this.vx;
                this.y += this.vy;
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.size, this.size);
            }
        }

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            particles = [];
            for (let i = 0; i < particleCount; i++) particles.push(new Particle());
        }
        window.addEventListener('resize', resize);
        resize();

        // Membuat fungsi kurva distorsi untuk suara lebih 'grit'
        function makeDistortionCurve(amount) {
            const k = typeof amount === 'number' ? amount : 50;
            const n_samples = 44100;
            const curve = new Float32Array(n_samples);
            const deg = Math.PI / 180;
            for (let i = 0; i < n_samples; ++i) {
                const x = i * 2 / n_samples - 1;
                curve[i] = (3 + k) * x * 20 * deg / (Math.PI + k * Math.abs(x));
            }
            return curve;
        }

        async function initAudio() {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            
            // Compressor agar audio tidak pecah (clipping)
            const limiter = audioCtx.createDynamicsCompressor();
            limiter.threshold.setValueAtTime(-10, audioCtx.currentTime);
            limiter.knee.setValueAtTime(40, audioCtx.currentTime);
            limiter.ratio.setValueAtTime(12, audioCtx.currentTime);
            limiter.connect(audioCtx.destination);

            masterGain = audioCtx.createGain();
            masterGain.gain.setValueAtTime(0, audioCtx.currentTime);
            masterGain.gain.linearRampToValueAtTime(0.8, audioCtx.currentTime + 1.5); // Naikkan ke 0.8
            masterGain.connect(limiter);

            const distortion = audioCtx.createWaveShaper();
            distortion.curve = makeDistortionCurve(100);
            distortion.oversampling = '4x';
            distortion.connect(masterGain);

            // Sub-bass rumble (55Hz lebih audible daripada 40Hz)
            const sub = audioCtx.createOscillator();
            const subGain = audioCtx.createGain();
            sub.type = 'sine';
            sub.frequency.setValueAtTime(55, audioCtx.currentTime);
            subGain.gain.value = 0.4;
            sub.connect(subGain);
            subGain.connect(masterGain);
            sub.start();

            // Drone "Whine" yang bereaksi terhadap intensitas
            droneOsc = audioCtx.createOscillator();
            droneGain = audioCtx.createGain();
            droneOsc.type = 'sawtooth'; // Suara lebih tajam
            droneOsc.frequency.setValueAtTime(110, audioCtx.currentTime);
            droneGain.gain.value = 0.05;
            
            // Filter drone agar tidak terlalu cempreng
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 400;

            droneOsc.connect(filter);
            filter.connect(droneGain);
            droneGain.connect(distortion);
            droneOsc.start();
        }

        function playGrain(freq, vol = 0.1) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.type = Math.random() > 0.5 ? 'square' : 'triangle';
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            
            g.gain.setValueAtTime(vol, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
            
            osc.connect(g);
            g.connect(masterGain);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        document.getElementById('ignite-btn').addEventListener('click', () => {
            initAudio();
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
                isRunning = true;
                loop();
            }, 1000);
        });

        window.addEventListener('mousemove', (e) => {
            mouse.x = e.clientX;
            mouse.y = e.clientY;
            cursor.style.left = e.clientX + 'px';
            cursor.style.top = e.clientY + 'px';
        });

        function loop() {
            if (!isRunning) return;

            ctx.fillStyle = 'rgba(0, 0, 0, 0.25)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            let intensity = 0;
            particles.forEach(p => {
                p.update();
                p.draw();
                const dx = mouse.x - p.x;
                const dy = mouse.y - p.y;
                if (Math.sqrt(dx*dx + dy*dy) < 40) intensity++;
            });

            currentIntensity = intensity;

            // Update Audio Drone secara real-time
            if (audioCtx) {
                // Drone naik frekuensinya jika massa bertambah
                droneOsc.frequency.setTargetAtTime(110 + intensity * 0.5, audioCtx.currentTime, 0.1);
                droneGain.gain.setTargetAtTime(0.05 + (intensity / 1000), audioCtx.currentTime, 0.1);
                
                // Trigger grains acak
                if (intensity > 15 && Math.random() > 0.85) {
                    playGrain(80 + intensity, 0.15);
                }
            }

            // UI update
            document.getElementById('mass-val').innerText = (1 + intensity/40).toFixed(1);
            document.getElementById('status-val').innerText = intensity > 150 ? 'KRITIS' : (intensity > 50 ? 'DISTORSI' : 'STABIL');
            
            const scale = 1 + intensity/80;
            cursor.style.transform = `translate(-50%, -50%) scale(${scale})`;
            cursor.style.borderColor = intensity > 150 ? '#ff0000' : 'rgba(255, 50, 0, 0.8)';

            requestAnimationFrame(loop);
        }
    </script>
</body>
</html>


